<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="adminUserMapper">
	
	<select id = "countByUser" resultType="int">
		select count(*) from users
		<where>
			<if test="username != null">and username = #{username}</if>
		</where>
	</select>
	
	<select id = "countByArtist" resultType="int">
		select count(*) from artist
		<where>
			<if test="username != null">and username = #{username}</if>
		</where>
	</select>
	
	<select id="findAllByUser" resultType="user">
		<![CDATA[
	      select B.username, B.irum, B.email
	      from
	         (select /*+ index_asc(users users_pk_username) */ rownum rnum, A.username, A.irum, A.email
	         from (
	            select username, irum, email
	            from users
	            order by username asc ) A
	         where rownum <= #{endRowNum})B
	      where B.rnum >= #{startRowNum}
		]]>
	</select>

	<select id = "findAllByArtist" resultType="artist">
	<![CDATA[
		select B.username, B.irum, B.email, B.artistno
	    	from
	       		(select /*+ index_asc(users users_pk_username) */ rownum rnum, A.username, A.irum, A.email, A.artistno
	         	from (
		            select u.username, u.irum, u.email, a.artistno
		            from users u, artist a
	                where u.username = a.username
		            order by username asc ) A
	         	where rownum <= #{endRowNum})B
	      	where B.rnum >= #{startRowNum}
	]]>
	</select>
	
	<select id="findUserByKeyWord" resultType="user">
	      select B.username, B.irum, B.email
	      from
	         (select /*+ index_asc(users users_pk_username) */ rownum rnum, A.username, A.irum, A.email
	         from (
	            select username, irum, email
	            from users
	       		where username like '%'|| #{keyWord} || '%'
	            order by username asc ) A
	         where rownum&lt;= #{endRow+Num})B
	      where B.rnum&gt;= #{startRowNum}
	</select>
	
	<update id= "updateByUser">
		update users set enabled = #{enabled} where username = #{username} and rownum = 1
	</update>
	
 </mapper>