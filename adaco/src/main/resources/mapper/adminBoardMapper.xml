<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="adminBoardMapper">
	
	<select id="countByQuestion" resultType="int">
		select count(*) from question
		<where>
			<if test="writer != null">and writer = #{writer}</if>
		</where>
	</select>
	
	<select id = "countByNotice" resultType="int">
		select count(*) from notice
	</select>
	
	<select id="countByReport" resultType="int">
		select count(*) from art_comments where report_cnt >= 1
	</select>
	
	<select id = "findAllByReport" resultType="artComment">
	   <![CDATA[
	      select B.cno, B.username, B.write_date writeDate, B.report_cnt reportCnt
	      from
	         (select /*+ index_asc(art_comments art_comments_pk_cno) */ rownum rnum, A.cno, A.username, A.write_date, A.report_cnt
	         from (
	            select cno, username, write_date, report_cnt
	            from art_comments
	            order by report_cnt desc ) A
	         where rownum <= #{endRowNum})B
	      where B.rnum >= #{startRowNum}
	   ]]>
	</select>
	
	<delete id ="deleteByReport">
		delete from art_comments where cno = #{cno} and rownum = 1
	</delete>
	
	<delete id = "deleteByArt">
		delete from art where artno = #{artno} and rownum = 1
	</delete>
	
	<select id = "findAllByQuestion" resultType="question">
		<![CDATA[
		      select B.qno, B.writer, B.title, B.write_date writeDate, B.state
		      from
		         (select /*+ index_asc(question question_pk_qno) */ rownum rnum, A.qno, A.writer, A.title, A.write_date, A.state
		         from (
		            select qno, writer, title, write_date, state
		            from question
		            order by write_date asc ) A
		         where rownum <= #{endRowNum})B
		      where B.rnum >= #{startRowNum}
		]]>
	</select>
	
	<!-- 1:1문의 작성자 검색인데 해봐야알듯 (DAO추가해야 됨) -->
	<select id="findQuestionById" resultType="question">
		select * from
			(select q.*,rownum as rnum from
				(select /*+ index_desc(question question_pk_qno) */ qno, writer, title, write_date writeDate from question
				  <trim prefix="WHERE" prefixOverrides="AND|OR">
				  	<if test="writer != null and writer != '' ">
                    	AND WRITER like '%' || #{writer} || '%'
                    </if>   
           		   </trim>
				) q
			    where rownum&lt;=#{endRowNum})
      		where rnum&gt;=#{startRowNum}
	</select>
		
	<update id = "updateQuestionByAnswer">
		update question set answer_content = #{answerContent}, answer = #{answer}, answer_date = #{answerDate}, state = #{state}
		where qno = #{qno} and rownum = 1
	</update>
	
	<insert id = "insertByQuestion">
		<selectKey keyProperty="qno" resultType="int" order="BEFORE">
			select question_seq.nextval from dual
		</selectKey>
		insert into question(qno, writer, content, title, write_date, important) values(#{qno}, #{writer}, #{content}, #{title}, #{writeDate})
	</insert>
	
	<select id="findAllByNotice" resultType="notice">
		<![CDATA[
			select B.noticeno, B.title, B.write_date writeDate, B.writer
				from
		    		(select /*+ index_asc(notice notice_pk_noticeno) */ rownum rnum, A.noticeno, A.title, A.write_date, A.writer
		         	from (
		            	select noticeno, title, write_date, writer
		            	from notice
		            	order by write_date desc ) A
		         	where rownum <= #{endRowNum})B
		      	where B.rnum >= #{startRowNum}
		]]>
	</select>
	
	<select id = "findAllByImportantNotice" resultType="notice">
		select noticeno, title, write_date writeDate, writer from notice where is_important = 1
	</select>
			
	<insert id = "insertByNotice">
		<selectKey keyProperty="noticeno" resultType="int" order="BEFORE">
			select notice_seq.nextval from dual
		</selectKey>
		insert into notice(noticeno, content, title, write_date, writer, is_important) values(#{noticeno}, #{content}, #{title}, #{writeDate}, #{writer}, #{isImportant})
	</insert>
	
	<update id = "updateByNotice">
		update notice
		<trim suffixOverrides="," prefix="SET">
			<if test="title != null">title = #{title},</if>
			<if test="content != null">content = #{content},</if>
			<if test="isImportant != null">is_important = #{isImportant},</if>
		</trim>
		where noticeno = #{noticeno}
	</update>
	
	<delete id="deleteByNotice">
		delete from notice where noticeno = #{noticeno} and rownum = 1
	</delete>
	
	<insert id="insertByFAQ">
		<selectKey keyProperty="faqno" resultType="int" order="BEFORE">
			select faq_seq.nextval from dual
		</selectKey>
		insert into faq(faqno, title, content) values(#{faqno}, #{title}, #{content})
	</insert>
	
	<select id="findAllByFAQ" resultType="faq">
		select faqno, title from faq
	</select>
	
	<select id="findFAQById" resultType="faq">
		select faqno, title, content from faq where faqno = #{faqno} and rownum = 1
	</select>
	
	<update id = "updateByFAQ">
		update faq
		<trim suffixOverrides="," prefix="SET">
			<if test="title != null">title = #{title},</if>
			<if test="content != null">content = #{content},</if>
		</trim>
		where faqno = #{faqno}
	</update>
	
	<delete id="deleteByFAQ">
		delete from faq where faqno = #{faqno} and rownum = 1
	</delete>
	
	<insert id = "insertByCategory">
		insert into category(category) values(#{category})
	</insert>
	
	<update id="updateByCategory">
		update category set category = #{category} and rownum = 1
	</update>
	
	<delete id = "deleteByCategory">
		delete category and category = #{category} and rownum = 1
	</delete>
	
</mapper>